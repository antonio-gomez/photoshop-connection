module.exports=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){/*
	 *
	 *  Photoshop-Connection
	 *  Node.js module for connecting to Adobe Photoshop Server.
	 *  Author: Antonio Gomez (https://github.com/antonio-gomez)
	 * 
	 *
	 *  @link https://github.com/antonio-gomez/photoshop-connection
	 *  @version v0.0.0
	 *  @license MIT
	 *
	 */
"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.photoshop=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(3),c=function(){function e(){r(this,e)}return o(e,[{key:"createClient",value:function(e){var t=new i.PhotoshopClient(e);return new Promise(function(e,n){t.connectToPhotoshop().then(function(t){e(t)}).catch(function(e){n(e)})})}}]),e}();t.photoshop=new c;e.exports=new c},function(e,t,n){var r,o;(function(e){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};/*!
	 *
	 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
	 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
	 *
	 * With parts by Tyler Close
	 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
	 * at http://www.opensource.org/licenses/mit-license.html
	 * Forked at ref_send.js version: 2009-05-11
	 *
	 * With parts by Mark Miller
	 * Copyright (C) 2011 Google Inc.
	 *
	 * Licensed under the Apache License, Version 2.0 (the "License");
	 * you may not use this file except in compliance with the License.
	 * You may obtain a copy of the License at
	 *
	 * http://www.apache.org/licenses/LICENSE-2.0
	 *
	 * Unless required by applicable law or agreed to in writing, software
	 * distributed under the License is distributed on an "AS IS" BASIS,
	 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	 * See the License for the specific language governing permissions and
	 * limitations under the License.
	 *
	 */
!function(c){if("function"==typeof bootstrap)bootstrap("promise",c);else if("object"===i(t)&&"object"===i(e))e.exports=c();else{r=c,o="function"==typeof r?r.call(t,n,t,e):r,!(void 0!==o&&(e.exports=o))}}(function(){function e(e){return function(){return $.apply(e,arguments)}}function t(e){return e===Object(e)}function n(e){return"[object StopIteration]"===ne(e)||e instanceof q}function r(e,t){if(Q&&t.stack&&"object"===("undefined"==typeof e?"undefined":i(e))&&null!==e&&e.stack&&e.stack.indexOf(re)===-1){for(var n=[],r=t;r;r=r.source)r.stack&&n.unshift(r.stack);n.unshift(e.stack);var c=n.join("\n"+re+"\n");e.stack=o(c)}}function o(e){for(var t=e.split("\n"),n=[],r=0;r<t.length;++r){var o=t[r];s(o)||c(o)||!o||n.push(o)}return n.join("\n")}function c(e){return e.indexOf("(module.js:")!==-1||e.indexOf("(node.js:")!==-1}function u(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(e);return r?[r[1],Number(r[2])]:void 0}function s(e){var t=u(e);if(!t)return!1;var n=t[0],r=t[1];return n===G&&r>=K&&r<=se}function f(){if(Q)try{throw new Error}catch(r){var e=r.stack.split("\n"),t=e[0].indexOf("@")>0?e[1]:e[2],n=u(t);if(!n)return;return G=n[0],n[1]}}function p(e,t,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+n+" instead.",new Error("").stack),e.apply(e,arguments)}}function a(e){return e instanceof y?e:w(e)?T(e):E(e)}function l(){function e(e){t=e,i.source=e,J(n,function(t,n){a.nextTick(function(){e.promiseDispatch.apply(e,n)})},void 0),n=void 0,r=void 0}var t,n=[],r=[],o=Z(l.prototype),i=Z(y.prototype);if(i.promiseDispatch=function(e,o,i){var c=H(arguments);n?(n.push(c),"when"===o&&i[1]&&r.push(i[1])):a.nextTick(function(){t.promiseDispatch.apply(t,c)})},i.valueOf=function(){if(n)return i;var e=m(t);return _(e)&&(t=e),e},i.inspect=function(){return t?t.inspect():{state:"pending"}},a.longStackSupport&&Q)try{throw new Error}catch(e){i.stack=e.stack.substring(e.stack.indexOf("\n")+1)}return o.promise=i,o.resolve=function(n){t||e(a(n))},o.fulfill=function(n){t||e(E(n))},o.reject=function(n){t||e(x(n))},o.notify=function(e){t||J(r,function(t,n){a.nextTick(function(){n(e)})},void 0)},o}function d(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=l();try{e(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}return t.promise}function h(e){return d(function(t,n){for(var r=0,o=e.length;r<o;r++)a(e[r]).then(t,n)})}function y(e,t,n){void 0===t&&(t=function(e){return x(new Error("Promise does not support operation: "+e))}),void 0===n&&(n=function(){return{state:"unknown"}});var r=Z(y.prototype);if(r.promiseDispatch=function(n,o,i){var c;try{c=e[o]?e[o].apply(r,i):t.call(r,o,i)}catch(e){c=x(e)}n&&n(c)},r.inspect=n,n){var o=n();"rejected"===o.state&&(r.exception=o.reason),r.valueOf=function(){var e=n();return"pending"===e.state||"rejected"===e.state?r:e.value}}return r}function v(e,t,n,r){return a(e).then(t,n,r)}function m(e){if(_(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function _(e){return e instanceof y}function w(e){return t(e)&&"function"==typeof e.then}function k(e){return _(e)&&"pending"===e.inspect().state}function g(e){return!_(e)||"fulfilled"===e.inspect().state}function S(e){return _(e)&&"rejected"===e.inspect().state}function b(){oe.length=0,ie.length=0,ue||(ue=!0)}function B(e,t){ue&&("object"===("undefined"==typeof process?"undefined":i(process))&&"function"==typeof process.emit&&a.nextTick.runAfter(function(){z(ie,e)!==-1&&(process.emit("unhandledRejection",t,e),ce.push(e))}),ie.push(e),t&&"undefined"!=typeof t.stack?oe.push(t.stack):oe.push("(no stack) "+t))}function j(e){if(ue){var t=z(ie,e);t!==-1&&("object"===("undefined"==typeof process?"undefined":i(process))&&"function"==typeof process.emit&&a.nextTick.runAfter(function(){var n=z(ce,e);n!==-1&&(process.emit("rejectionHandled",oe[t],e),ce.splice(n,1))}),ie.splice(t,1),oe.splice(t,1))}}function x(e){var t=y({when:function(t){return t&&j(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return B(t,e),t}function E(e){return y({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},delete:function(t){delete e[t]},post:function(t,n){return null===t||void 0===t?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return te(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function T(e){var t=l();return a.nextTick(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}}),t.promise}function O(e){return y({isDef:function(){}},function(t,n){return I(e,t,n)},function(){return a(e).inspect()})}function P(e,t,n){return a(e).spread(t,n)}function C(e){return function(){function t(e,t){var c;if("undefined"==typeof StopIteration){try{c=r[e](t)}catch(e){return x(e)}return c.done?a(c.value):v(c.value,o,i)}try{c=r[e](t)}catch(e){return n(e)?a(e.value):x(e)}return v(c,o,i)}var r=e.apply(this,arguments),o=t.bind(t,"next"),i=t.bind(t,"throw");return o()}}function N(e){a.done(a.async(e)())}function D(e){throw new q(e)}function R(e){return function(){return P([this,F(arguments)],function(t,n){return e.apply(t,n)})}}function I(e,t,n){return a(e).dispatch(t,n)}function F(e){return v(e,function(e){var t=0,n=l();return J(e,function(r,o,i){var c;_(o)&&"fulfilled"===(c=o.inspect()).state?e[i]=c.value:(++t,v(o,function(r){e[i]=r,0===--t&&n.resolve(e)},n.reject,function(e){n.notify({index:i,value:e})}))},void 0),0===t&&n.resolve(e),n.promise})}function M(e){if(0===e.length)return a.resolve();var t=a.defer(),n=0;return J(e,function(r,o,i){function c(e){t.resolve(e)}function u(){n--,0===n&&t.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}function s(e){t.notify({index:i,value:e})}var f=e[i];n++,v(f,c,u,s)},void 0),t.promise}function U(e){return v(e,function(e){return e=X(e,a),v(F(X(e,function(e){return v(e,Y,Y)})),function(){return e})})}function A(e){return a(e).allSettled()}function L(e,t){return a(e).then(void 0,void 0,t)}function W(e,t){return a(e).nodeify(t)}var Q=!1;try{throw new Error}catch(e){Q=!!e.stack}var G,q,K=f(),Y=function(){},V=function(){function e(){for(var e,r;n.next;)n=n.next,e=n.task,n.task=void 0,r=n.domain,r&&(n.domain=void 0,r.enter()),t(e,r);for(;s.length;)e=s.pop(),t(e);o=!1}function t(t,n){try{t()}catch(t){if(u)throw n&&n.exit(),setTimeout(e,0),n&&n.enter(),t;setTimeout(function(){throw t},0)}n&&n.exit()}var n={task:void 0,next:null},r=n,o=!1,c=void 0,u=!1,s=[];if(V=function(e){r=r.next={task:e,domain:u&&process.domain,next:null},o||(o=!0,c())},"object"===("undefined"==typeof process?"undefined":i(process))&&"[object process]"===process.toString()&&process.nextTick)u=!0,c=function(){process.nextTick(e)};else if("function"==typeof setImmediate)c="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var f=new MessageChannel;f.port1.onmessage=function(){c=p,f.port1.onmessage=e,e()};var p=function(){f.port2.postMessage(0)};c=function(){setTimeout(e,0),p()}}else c=function(){setTimeout(e,0)};return V.runAfter=function(e){s.push(e),o||(o=!0,c())},V}(),$=Function.call,H=e(Array.prototype.slice),J=e(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}for(;n<r;n++)n in this&&(t=e(t,this[n],n));return t}),z=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),X=e(Array.prototype.map||function(e,t){var n=this,r=[];return J(n,function(o,i,c){r.push(e.call(t,i,c,n))},void 0),r}),Z=Object.create||function(e){function t(){}return t.prototype=e,new t},ee=e(Object.prototype.hasOwnProperty),te=Object.keys||function(e){var t=[];for(var n in e)ee(e,n)&&t.push(n);return t},ne=e(Object.prototype.toString);q="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var re="From previous event:";a.resolve=a,a.nextTick=V,a.longStackSupport=!1,"object"===("undefined"==typeof process?"undefined":i(process))&&process&&process.env&&process.env.Q_DEBUG&&(a.longStackSupport=!0),a.defer=l,l.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(H(arguments,1)):e.resolve(n)}},a.Promise=d,a.promise=d,d.race=h,d.all=F,d.reject=x,d.resolve=a,a.passByCopy=function(e){return e},y.prototype.passByCopy=function(){return this},a.join=function(e,t){return a(e).join(t)},y.prototype.join=function(e){return a([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},a.race=h,y.prototype.race=function(){return this.then(a.race)},a.makePromise=y,y.prototype.toString=function(){return"[object Promise]"},y.prototype.then=function(e,t,n){function o(t){try{return"function"==typeof e?e(t):t}catch(e){return x(e)}}function i(e){if("function"==typeof t){r(e,u);try{return t(e)}catch(e){return x(e)}}return x(e)}function c(e){return"function"==typeof n?n(e):e}var u=this,s=l(),f=!1;return a.nextTick(function(){u.promiseDispatch(function(e){f||(f=!0,s.resolve(o(e)))},"when",[function(e){f||(f=!0,s.resolve(i(e)))}])}),u.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=c(e)}catch(e){if(n=!0,!a.onerror)throw e;a.onerror(e)}n||s.notify(t)}]),s.promise},a.tap=function(e,t){return a(e).tap(t)},y.prototype.tap=function(e){return e=a(e),this.then(function(t){return e.fcall(t).thenResolve(t)})},a.when=v,y.prototype.thenResolve=function(e){return this.then(function(){return e})},a.thenResolve=function(e,t){return a(e).thenResolve(t)},y.prototype.thenReject=function(e){return this.then(function(){throw e})},a.thenReject=function(e,t){return a(e).thenReject(t)},a.nearer=m,a.isPromise=_,a.isPromiseAlike=w,a.isPending=k,y.prototype.isPending=function(){return"pending"===this.inspect().state},a.isFulfilled=g,y.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},a.isRejected=S,y.prototype.isRejected=function(){return"rejected"===this.inspect().state};var oe=[],ie=[],ce=[],ue=!0;a.resetUnhandledRejections=b,a.getUnhandledReasons=function(){return oe.slice()},a.stopUnhandledRejectionTracking=function(){b(),ue=!1},b(),a.reject=x,a.fulfill=E,a.master=O,a.spread=P,y.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},a.async=C,a.spawn=N,a.return=D,a.promised=R,a.dispatch=I,y.prototype.dispatch=function(e,t){var n=this,r=l();return a.nextTick(function(){n.promiseDispatch(r.resolve,e,t)}),r.promise},a.get=function(e,t){return a(e).dispatch("get",[t])},y.prototype.get=function(e){return this.dispatch("get",[e])},a.set=function(e,t,n){return a(e).dispatch("set",[t,n])},y.prototype.set=function(e,t){return this.dispatch("set",[e,t])},a.del=a.delete=function(e,t){return a(e).dispatch("delete",[t])},y.prototype.del=y.prototype.delete=function(e){return this.dispatch("delete",[e])},a.mapply=a.post=function(e,t,n){return a(e).dispatch("post",[t,n])},y.prototype.mapply=y.prototype.post=function(e,t){return this.dispatch("post",[e,t])},a.send=a.mcall=a.invoke=function(e,t){return a(e).dispatch("post",[t,H(arguments,2)])},y.prototype.send=y.prototype.mcall=y.prototype.invoke=function(e){return this.dispatch("post",[e,H(arguments,1)])},a.fapply=function(e,t){return a(e).dispatch("apply",[void 0,t])},y.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},a.try=a.fcall=function(e){return a(e).dispatch("apply",[void 0,H(arguments,1)])},y.prototype.fcall=function(){return this.dispatch("apply",[void 0,H(arguments)])},a.fbind=function(e){var t=a(e),n=H(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(H(arguments))])}},y.prototype.fbind=function(){var e=this,t=H(arguments);return function(){return e.dispatch("apply",[this,t.concat(H(arguments))])}},a.keys=function(e){return a(e).dispatch("keys",[])},y.prototype.keys=function(){return this.dispatch("keys",[])},a.all=F,y.prototype.all=function(){return F(this)},a.any=M,y.prototype.any=function(){return M(this)},a.allResolved=p(U,"allResolved","allSettled"),y.prototype.allResolved=function(){return U(this)},a.allSettled=A,y.prototype.allSettled=function(){return this.then(function(e){return F(X(e,function(e){function t(){return e.inspect()}return e=a(e),e.then(t,t)}))})},a.fail=a.catch=function(e,t){return a(e).then(void 0,t)},y.prototype.fail=y.prototype.catch=function(e){return this.then(void 0,e)},a.progress=L,y.prototype.progress=function(e){return this.then(void 0,void 0,e)},a.fin=a.finally=function(e,t){return a(e).finally(t)},y.prototype.fin=y.prototype.finally=function(e){return e=a(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},a.done=function(e,t,n,r){return a(e).done(t,n,r)},y.prototype.done=function(e,t,n){var o=function(e){a.nextTick(function(){if(r(e,c),!a.onerror)throw e;a.onerror(e)})},c=e||t||n?this.then(e,t,n):this;"object"===("undefined"==typeof process?"undefined":i(process))&&process&&process.domain&&(o=process.domain.bind(o)),c.then(void 0,o)},a.timeout=function(e,t,n){return a(e).timeout(t,n)},y.prototype.timeout=function(e,t){var n=l(),r=setTimeout(function(){t&&"string"!=typeof t||(t=new Error(t||"Timed out after "+e+" ms"),t.code="ETIMEDOUT"),n.reject(t)},e);return this.then(function(e){clearTimeout(r),n.resolve(e)},function(e){clearTimeout(r),n.reject(e)},n.notify),n.promise},a.delay=function(e,t){return void 0===t&&(t=e,e=void 0),a(e).delay(t)},y.prototype.delay=function(e){return this.then(function(t){var n=l();return setTimeout(function(){n.resolve(t)},e),n.promise})},a.nfapply=function(e,t){return a(e).nfapply(t)},y.prototype.nfapply=function(e){var t=l(),n=H(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},a.nfcall=function(e){var t=H(arguments,1);return a(e).nfapply(t)},y.prototype.nfcall=function(){var e=H(arguments),t=l();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},a.nfbind=a.denodeify=function(e){var t=H(arguments,1);return function(){var n=t.concat(H(arguments)),r=l();return n.push(r.makeNodeResolver()),a(e).fapply(n).fail(r.reject),r.promise}},y.prototype.nfbind=y.prototype.denodeify=function(){var e=H(arguments);return e.unshift(this),a.denodeify.apply(void 0,e)},a.nbind=function(e,t){var n=H(arguments,2);return function(){function r(){return e.apply(t,arguments)}var o=n.concat(H(arguments)),i=l();return o.push(i.makeNodeResolver()),a(r).fapply(o).fail(i.reject),i.promise}},y.prototype.nbind=function(){var e=H(arguments,0);return e.unshift(this),a.nbind.apply(void 0,e)},a.nmapply=a.npost=function(e,t,n){return a(e).npost(t,n)},y.prototype.nmapply=y.prototype.npost=function(e,t){var n=H(t||[]),r=l();return n.push(r.makeNodeResolver()),this.dispatch("post",[e,n]).fail(r.reject),r.promise},a.nsend=a.nmcall=a.ninvoke=function(e,t){var n=H(arguments,2),r=l();return n.push(r.makeNodeResolver()),a(e).dispatch("post",[t,n]).fail(r.reject),r.promise},y.prototype.nsend=y.prototype.nmcall=y.prototype.ninvoke=function(e){var t=H(arguments,1),n=l();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},a.nodeify=W,y.prototype.nodeify=function(e){return e?void this.then(function(t){a.nextTick(function(){e(null,t)})},function(t){a.nextTick(function(){e(t)})}):this},a.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var se=f();return a})}).call(t,n(2)(e))},function(e,t){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t,n){/*
	 *
	 *  Photoshop-Connection
	 *  Node.js module for connecting to Adobe Photoshop Server.
	 *  Author: Antonio Gomez (https://github.com/antonio-gomez)
	 * 
	 *
	 *  @link https://github.com/antonio-gomez/photoshop-connection
	 *  @version v0.0.0
	 *  @license MIT
	 *
	 */
"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(4);t.PhotoshopClient=function(){function e(t){r(this,e),this.options=t,this._photoshop=null}return o(e,[{key:"connectToPhotoshop",value:function(){var e=this;return this._photoshop=i.createClient(this.options),new Promise(function(t,n){e._photoshop.once("connect",function(){console.log("Connected to Photoshop on port "+e.options.port),t(e._photoshop)}),e._photoshop.on("error",function(e){n(e)})})}}]),e}()},function(e,t,n){"use strict";!function(){function e(e,t,n){if(e.length>=t)return e;var r=new Buffer(t);return n?e.copy(r,0,0,n):e.copy(r),r}function r(e,t){var n=Math.pow(10,t);return Math.round(n*e)/n}function o(e,t,n){var r=this;if(!(r instanceof o))return new o(e,t,n);var i=a;e.hasOwnProperty("password")&&(i=e.password),e.hasOwnProperty("port")&&(r._port=e.port),e.hasOwnProperty("hostname")&&(r._hostname=e.hostname),e.hasOwnProperty("inputFd")&&(r._inputFd=e.inputFd),e.hasOwnProperty("outputFd")&&(r._outputFd=e.outputFd),r._logger=n,r._receiveBuffer=new Buffer(N),r._receivedBytes=0,r._writeQueue=[],t&&this.once("connect",t);var c=null,u=null;if("number"==typeof r._inputFd&&"number"==typeof r._outputFd||"string"==typeof r._inputFd&&"string"==typeof r._outputFd){c=r._connectPipe();var s=f.defer();s.resolve(),u=s.promise}else if(r._hostname&&"number"==typeof r._port)c=r._connectSocket(),u=r._initCrypto(i);else{var p=f.defer();p.reject(),c=p.promise}f.all([c,u]).done(function(){r.emit("connect")},function(e){r.emit("error",e),r.disconnect()})}function i(e,t,n){return new o(e,t,n)}var c=n(10),u=n(7).EventEmitter,s=n(9),f=n(1),p=n(5),a="password",l=49494,d="127.0.0.1",h=1e3,y={NONE:0,CONNECTING:1,OPEN:2,CLOSING:3,CLOSED:4,DESTROYED:5},v=0,m=4,_=4,w=m+_,k=12,g=0,S=4,b=8,B=16777216,j=1,x=1,E=2,T=3,O=4,P=6,C=0,N=65536,D=["","[ActionDescriptor]","Yep, still alive"];c.inherits(o,u),o.prototype._port=l,o.prototype._hostname=d,o.prototype._connectionState=y.NONE,o.prototype._lastMessageID=0,o.prototype._crypto=null,o.prototype._receiveBuffer=null,o.prototype._receivedBytes=0,o.prototype._writeQueue=null,o.prototype._commandDeferreds=null,o.prototype._initCrypto=function(e){var t=this,n=f.defer();return p.createPSCrypto(e,function(e,r){e?n.reject(e):(t._crypto=r,n.resolve())}),n.promise},o.prototype._connectPipe=function(){var t=this,r=n(8),o=!1;try{t._connectionState=y.CONNECTING,"number"==typeof t._inputFd?t._readStream=r.createReadStream(null,{fd:t._inputFd}):(t.emit("info","using named read pipe "+t._inputFd),t._readStream=r.createReadStream(t._inputFd)),t._readStream.on("data",function(n){var r=0===t._receivedBytes,o=n.length+t._receivedBytes;t._receiveBuffer=e(t._receiveBuffer,o),n.copy(t._receiveBuffer,t._receivedBytes),t._receivedBytes+=n.length,t._processReceiveBuffer(r)}),t._readStream.on("error",function(e){t.emit("error","Pipe read error: "+e),t.disconnect()}),t._readStream.on("close",function(){t._connectionState=y.CLOSED,t.emit("close")}),t._readStream.resume(),"number"==typeof t._outputFd?t._writeStream=r.createWriteStream(null,{fd:t._outputFd}):(t.emit("info","using named write pipe "+t._outputFd),t._writeStream=r.createWriteStream(t._outputFd)),t._writeStream.on("error",function(e){t.emit("error","Pipe write error: "+e),t.disconnect()}),t._writeStream.on("close",function(){t._connectionState=y.CLOSED,t.emit("close")}),t._writeStream.on("drain",function(){t._doPendingWrites()}),o=!0}catch(e){t.emit("error","Connect Pipe error: "+e),t.disconnect()}return o},o.prototype._connectSocket=function(){var t=this,n=f.defer();return t._socket=new s.Socket,t._connectionState=y.CONNECTING,t._socket.connect(t._port,t._hostname),t._socket.on("connect",function(){t._socket.setKeepAlive(!0,h),t._socket.setNoDelay(),n.resolve(t),t._writeStream=t._socket}),t._socket.on("error",function(e){n.promise.isPending()&&n.reject(e),t.emit("error","Socket error: "+e),t.disconnect()}),t._socket.on("close",function(){t._connectionState=y.CLOSED,t.emit("close")}),t._socket.on("data",function(n){var r=0===t._receivedBytes,o=n.length+t._receivedBytes;t._receiveBuffer=e(t._receiveBuffer,o),n.copy(t._receiveBuffer,t._receivedBytes),t._receivedBytes+=n.length,t._processReceiveBuffer(r)}),t._socket.on("drain",function(){t._doPendingWrites()}),n.promise},o.prototype._writeWhenFree=function(e){var t=this;t._writeQueue.push(e),process.nextTick(function(){t._doPendingWrites()})},o.prototype._doPendingWrites=function(){if(this._writeStream&&this._writeQueue.length>0&&!this._writeStream.busy){var e=this._writeQueue.shift(),t=this._writeStream.write(e);t&&this._writeQueue.length>0&&this._doPendingWrites()}this._writeStream&&this._writeQueue.length>0&&process.nextTick(this._doPendingWrites.bind(this))},o.prototype.isConnected=function(){return this._connectionState===y.OPEN},o.prototype.disconnect=function(e){if(e||(e=function(){}),!this._socket){if(this._readStream){try{this._readStream.close()}catch(e){}this._readStream=null}if(this._writeStream){try{this._writeStream.close()}catch(e){}this._writeStream=null}return this._connectionState=y.CLOSED,process.nextTick(e),!0}var t=this._connectionState;switch(t){case y.NONE:return this._connectionState=y.CLOSED,process.nextTick(e),!0;case y.CONNECTING:return this._connectionState=y.CLOSING,this._socket.once("close",e),this._socket.end(),!0;case y.OPEN:return this._connectionState=y.CLOSING,this._socket.once("close",e),this._socket.end(),!0;case y.CLOSING:return this._socket.once("close",e),!0;case y.CLOSED:return process.nextTick(e),!0;case y.DESTROYED:return process.nextTick(e),!0}},o.prototype.destroy=function(){this._connectionState=y.DESTROYED,this._socket&&this._socket.destroy()},o.prototype._sendMessage=function(e){var t=this._crypto?this._crypto.cipher(e):e,n=new Buffer(w),r=t.length+_;n.writeUInt32BE(r,v),n.writeInt32BE(C,m),this._writeWhenFree(n),this._writeWhenFree(t)},o.prototype.sendKeepAlive=function(){var e=this._lastMessageID=(this._lastMessageID+1)%B,t=new Buffer(k);return t.writeUInt32BE(j,g),t.writeUInt32BE(e,S),t.writeUInt32BE(P,b),this._sendMessage(t),e},o.prototype.sendCommand=function(e){var t=this._lastMessageID=(this._lastMessageID+1)%B,n=new Buffer(e,"utf8"),r=new Buffer(n.length+k);return r.writeUInt32BE(j,g),r.writeUInt32BE(t,S),r.writeUInt32BE(E,b),n.copy(r,k),this._sendMessage(r),t},o.prototype._processReceiveBuffer=function(t){if(t&&this._receivedBytes>0&&(this.messageStartTime=(new Date).getTime()),!(this._receivedBytes<w)){var n=this._receiveBuffer.readInt32BE(m);if(n!==C)return console.error("Communication error: "+n),this.emit("communicationsError","Photoshop communication error: "+n),void this.disconnect();var o=this._receiveBuffer.readUInt32BE(v),i=o+m;if(this._receiveBuffer=e(this._receiveBuffer,i,this._receivedBytes),!(this._receivedBytes<i)){var c=(new Date).getTime()-this.messageStartTime;if(c>10){var u=this._receivedBytes/1024,s=u/(c/1e3);this._logger.info(c+"ms to receive "+r(u,1)+" kB ("+r(s,1)+" kB/s)")}var f=this._receiveBuffer.slice(w,i),p=this._receivedBytes-i,a=Math.max(N,p),l=this._receiveBuffer;this._receiveBuffer=new Buffer(a),p>0&&l.copy(this._receiveBuffer,0,i,this._receivedBytes),this._receivedBytes=p;var d=(new Date).getTime(),h=this._crypto?this._crypto.decipher(f):f;c=(new Date).getTime()-d,c>10&&this._logger.info(c+"ms to decrypt buffer"),this._processMessage(h),this._processReceiveBuffer(!0)}}},o.prototype._processMessage=function(e){var t=e.readUInt32BE(g),n=e.readUInt32BE(S),r=e.readUInt32BE(b),o=e.slice(k),i={protocolVersion:t,id:n,type:r,body:o};if(t!==j)this.emit("communicationsError","unknown protocol version",t);else if(r===E){var c=o.toString("utf8"),u=c.split("\r"),s=null,f=null;if(2===u.length&&(s=u[0]),f=u[u.length-1],D.indexOf(f)===-1)try{f=JSON.parse(f)}catch(e){}s?this.emit("event",n,s,f,i):this.emit("message",n,f,i)}else r===T?this.emit("pixmap",n,o,i):r===O?this.emit("iccProfile",n,o,i):r===x?this.emit("error",{id:n,body:o.toString("utf8")}):this.emit("communicationsError","unknown message type",r)},t.PhotoshopClient=o,t.createClient=i}()},function(e,t,n){"use strict";!function(){function e(e){this._derivedKey=e}function r(t,n){o.pbkdf2(t,i,c,s,function(t,r){t?n(t,null):n(null,new e(r))})}var o=n(6),i="Adobe Photoshop",c=1e3,u="des-ede3-cbc",s=24,f=new Buffer("000000005d260000","hex");e.prototype.decipher=function(e){var t=o.createDecipheriv(u,this._derivedKey,f);return new Buffer(t.update(e,"binary","binary")+t.final("binary"),"binary")},e.prototype.cipher=function(e){var t=o.createCipheriv(u,this._derivedKey,f);return new Buffer(t.update(e,"binary","binary")+t.final("binary"),"binary")},t.createPSCrypto=r}()},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("net")},function(e,t){e.exports=require("util")}]);